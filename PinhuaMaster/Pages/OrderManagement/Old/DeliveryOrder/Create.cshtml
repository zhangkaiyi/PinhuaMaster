@page
@model PinhuaMaster.Pages.OrderManagement.Old.DeliveryOrder.CreateModel
@{
    ViewData["Title"] = "Create";
}

<section class="invoice" id="invoice" style="margin:0px;margin-bottom:20px;">
    <div class="row">
        <div class="col-xs-12">
            <h2 class="page-header">
                <i class="fa fa-globe"></i> 胜美木业, Inc.
                <small class="pull-right">Date:  @DateTime.UtcNow.ToString("yyyy/M/d")</small>
            </h2>
        </div>
        <!-- /.col -->
    </div>
    <!-- info row -->
    <form method="post" id="出库单">
        <div class="row invoice-info">
            <div class="col-sm-4 invoice-col">
                <div class="form-group has-error">
                    <label class="control-label" asp-for="Input.stockoutType"><i class="fa fa-angle-double-right"></i> @Html.DisplayNameFor(x => x.Input.stockoutType)</label>
                    <div class="input-group">
                        <select class="form-control" name="stockoutType" asp-for="Input.stockoutType" asp-items="Model.DeliveryTypes"></select>
                        <span class="input-group-btn">
                            <button type="button" class="btn btn-danger btn-flat" style="width:40px"><i class="fa fa-bars"></i></button>
                        </span>
                    </div>
                </div>
                <div class="form-group has-error">
                    <label class="control-label" asp-for="Input.customerId"><i class="fa fa-angle-double-right"></i> @Html.DisplayNameFor(x => x.Input.customerId)</label>
                    <div class="input-group">
                        <select class="form-control" name="customerId" asp-for="Input.customerName" asp-items="Model.Customers"></select>
                        <span class="input-group-btn">
                            <button type="button" class="btn btn-danger btn-flat" style="width:40px"><i class="fa fa-truck"></i></button>
                        </span>
                    </div>
                </div>
                <div class="form-group has-error">
                    <label class="control-label" asp-for="Input.stockoutDate"><i class="fa fa-angle-double-right"></i> @Html.DisplayNameFor(x => x.Input.stockoutDate)</label>
                    <div class="input-group">
                        <input type="text" asp-for="Input.stockoutDate" data-provide="datepicker" data-date-format="yyyy-mm-dd" readonly class="form-control pull-right" />
                        <span class="input-group-btn">
                            <button type="button" class="btn btn-danger btn-flat" style="width:40px"><i class="fa fa-calendar-o"></i></button>
                        </span>
                    </div>
                    <span class="help-block" asp-validation-for="Input.stockoutDate"></span>
                </div>
                <div class="form-group has-error">
                    <label class="control-label" asp-for="Input.stockoutAddress"><i class="fa fa-angle-double-right"></i> 地址</label>
                    <div class="input-group">
                        <input asp-for="Input.stockoutAddress" class="form-control" placeholder="输入 ..." />
                        <span class="input-group-btn">
                            <button type="button" class="btn btn-danger btn-flat" style="width:40px"><i class="fa fa-map-o"></i></button>
                        </span>
                    </div>
                </div>
            </div>
            <!-- /.col -->
            <div class="col-sm-4 invoice-col">
                <div class="form-group has-warning">
                    <label class="control-label" asp-for="Input.stockoutContact"><i class="fa fa-angle-double-right"></i> @Html.DisplayNameFor(x => x.Input.stockoutContact)</label>
                    <div class="input-group">
                        <input type="text" asp-for="Input.stockoutContact" class="form-control" placeholder="输入 ..." />
                        <span class="input-group-btn">
                            <button type="button" class="btn btn-warning btn-flat" style="width:40px"><i class="fa fa-user"></i></button>
                        </span>
                    </div>
                </div>
                <div class="form-group has-warning">
                    <label class="control-label" asp-for="Input.stockoutContactNumber"><i class="fa fa-angle-double-right"></i> @Html.DisplayNameFor(x => x.Input.stockoutContactNumber)</label>
                    <div class="input-group">
                        <input type="text" asp-for="Input.stockoutContactNumber" class="form-control" placeholder="输入 ..." />
                        <span class="input-group-btn">
                            <button type="button" class="btn btn-warning btn-flat" style="width:40px"><i class="fa fa-phone"></i></button>
                        </span>
                    </div>
                </div>
                <div class="form-group has-warning">
                    <label class="control-label" asp-for="Input.stockoutRemarks">
                        <i class="fa fa-bell-o"></i> @Html.DisplayNameFor(x => x.Input.stockoutRemarks)
                    </label>
                    <div class="input-group">
                        <textarea asp-for="Input.stockoutRemarks" class="form-control" , rows="3" , placeholder="输入 ..."></textarea>
                        <span class="input-group-addon"><i class="fa fa-commenting"></i></span>
                    </div>
                    <span class="help-block">在此输入你的备注信息</span>
                </div>
            </div>
            <!-- /.col -->
            <div class="col-sm-4 invoice-col">
                <div class="form-group">
                    <label class="control-label" asp-for="Input.orderId"><i class="fa fa-angle-double-right"></i> @Html.DisplayNameFor(x => x.Input.orderId)</label>
                    <div class="input-group">
                        <input type="text" asp-for="Input.orderId" class="form-control" readonly />
                        <span class="input-group-btn">
                            <button type="button" class="btn btn-default btn-flat" style="width:40px"><i class="fa fa-sticky-note-o"></i></button>
                        </span>
                    </div>
                </div>
                <div class="form-group">
                    <label class="control-label" asp-for="Input.CreatedBy"><i class="fa fa-angle-double-right"></i> @Html.DisplayNameFor(x => x.Input.CreatedBy)</label>
                    <div class="input-group">
                        <input type="text" asp-for="Input.CreatedBy" class="form-control" readonly />
                        <span class="input-group-btn">
                            <button type="button" class="btn btn-default btn-flat" style="width:40px"><i class="fa fa-user-o"></i></button>
                        </span>
                    </div>
                </div>
                <div class="form-group">
                    <label class="control-label" asp-for="Input.CreatedDate"><i class="fa fa-angle-double-right"></i> @Html.DisplayNameFor(x => x.Input.CreatedDate)</label>
                    <div class="input-group">
                        <input type="text" asp-for="Input.CreatedDate" class="form-control" readonly />
                        <span class="input-group-btn">
                            <button type="button" class="btn btn-default btn-flat" style="width:40px"><i class="fa fa-calendar-o"></i></button>
                        </span>
                    </div>
                </div>
            </div>
            <!-- /.col -->
        </div>
        <!-- /.row -->
        <!-- /.row -->
    </form>
</section>
<div class="row">
    <div class="col-xs-12">
        <div class="box box-solid" id="formBox" v-cloak>
            <div class="box-header with-border">
                <div class="box-title">出库清单</div>
                <div class="box-tools">
                    <a class="btn btn-primary btn-sm btn-flat" data-toggle="modal" data-target="#itemsModal" data-backdrop="false">
                        <i class="fa fa-plus"></i>　添加物品
                    </a>
                </div>
            </div>
            <div class="box-body no-padding" v-if="visible">
                <div class="table-responsive">
                    <table class="table table-striped table-bordered" id="formTable" style="min-width:800px">
                        <thead>
                            <tr>
                                <th style="max-width:20px">RN</th>
                                <th style="min-width:80px;">编号</th>
                                <th style="min-width:80px;">描述</th>
                                <th style="min-width:80px;">规格</th>
                                <th style="min-width:80px;">片数</th>
                                <th style="min-width:80px;">单位数量</th>
                                <th style="min-width:80px;">计价单位</th>
                                <th style="min-width:80px;">单价</th>
                                <th style="min-width:80px;">金额</th>
                                <th style="max-width:50px;" class="text-right"></th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-for="(todo,index) in todos">
                                <td>{{ index + 1 }}<input type="hidden" v-bind:value="index + 1" v-bind:name="inputName+'['+index+'].rN'" /></td>
                                <td>{{ todo.编号 }}<input type="hidden" v-model="todo.编号" v-bind:name="inputName+'['+index+'].编号'" /></td>
                                <td>{{ todo.描述 }}<input type="hidden" v-model="todo.描述" v-bind:name="inputName+'['+index+'].描述'" /></td>
                                <td>{{ todo.规格 }}<input type="hidden" v-model="todo.规格" v-bind:name="inputName+'['+index+'].规格'" /></td>
                                <td><input v-model.number="todo.pcs" type="number" v-bind:name="inputName+'['+index+'].个数'" /></td>
                                <td>
                                    {{computeQuantity(todo)}}<input type="hidden" v-bind:value="computeQuantity(todo)" v-bind:name="inputName+'['+index+'].数量'" />
                                </td>
                                <td>
                                    <select v-model="todo.unit" v-bind:name="inputName+'['+index+'].单位'">
                                        <option>PCS</option>
                                        <option>平方米</option>
                                        <option>延长米</option>
                                        <option>立方米</option>
                                        <option>套</option>
                                    </select>
                                </td>
                                <td><input v-model.number="todo.price" type="number" v-bind:name="inputName+'['+index+'].单价'" /></td>
                                <td>
                                    {{parseFloat((todo.price||0) * computeQuantity(todo)).toFixed(2)}}
                                    <input type="hidden" v-bind:value="parseFloat((todo.price||0) * computeQuantity(todo)).toFixed(2)" v-bind:name="inputName+'['+index+'].金额'" />
                                </td>
                                <td class="text-right">
                                    <button class="btn btn-xs btn-danger" v-on:click="removeTodo(index)"><i class="fa fa-close"></i></button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="box-footer">
                <a class="btn btn-default" href="javascript:$('#出库单').submit();"><i class="fa fa-check"></i>&nbsp;提交</a>
            </div>
        </div>
    </div>
    <!-- /.col -->
</div>

@section Scripts{
    <environment include="Development">
        <script src="~/lib/vue/dist/vue.js"></script>
    </environment>
    <environment exclude="Development">
        <script src="~/lib/vue/dist/vue.min.js"></script>
    </environment>

    <script>
        var vm = new Vue({
            el: '#formBox',
            data: {
                todos: [],
                inputName: '',
            },
            computed: {
                visible: function () {
                    return this.todos.length > 0
                }
            },
            methods: {
                addTodo: function () {
                    var text = this.newTodo.trim()
                    if (text) {
                        this.todos.push({ text: text })
                        this.newTodo = ''
                    }
                },
                removeTodo: function (index) {
                    this.todos.splice(index, 1)
                },
                // 计算单位数量
                computeQuantity: function (item) {
                    var result = 0
                    if (item.unit == 'PCS')
                        result = item.pcs
                    else if (item.unit == '平方米')
                        result = item.pcs * item.length * item.width / 1000 / 1000
                    else if (item.unit == '延长米')
                        result = item.pcs * item.length / 1000
                    result = result || ""
                    return new Number(result).toFixed(4)
                }
            }
        })
    </script>
}
